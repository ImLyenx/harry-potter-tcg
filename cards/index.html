<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../global.css" />
    <link rel="stylesheet" href="style.css" />
    <script
      defer
      src="https://kit.fontawesome.com/aa06e5f929.js"
      crossorigin="anonymous"
    ></script>
    <meta name="description" content="Rules of the game" />
    <link
      rel="shortcut icon"
      href="../assets/images/logo.png"
      type="image/x-icon"
    />
    <title>Cards</title>
  </head>
  <body>
    <header>
      <div class="logo">
        <img src="../assets/images/logo.png" alt="" />
      </div>
      <nav>
        <ul class="navbar-list">
          <li>
            <a href="/">
              <i class="fas fa-house"></i>
              <span class="nav-link">Home</span></a
            >
          </li>
          <li>
            <a href="/rules/"
              ><i class="fas fa-clipboard-check"></i
              ><span class="nav-link">Rules</span></a
            >
          </li>
          <li>
            <a href="/cards/"
              ><i class="fas fa-sheet-plastic"></i
              ><span class="nav-link">Cards</span></a
            >
          </li>
        </ul>
      </nav>
      <form class="search">
        <input
          id="searchInput"
          type="text"
          placeholder="Search..."
          oninput="search()"
        />
        <button id="submit-search" type="submit" aria-label="Submit button">
          <i class="fas fa-magnifying-glass"></i>
        </button>
      </form>
      <script>
        function search() {
          const searchTerm = document
            .getElementById("searchInput")
            .value.toLowerCase();

          const cards = document.querySelectorAll(".card-img");
          cards.forEach((card) => {
            const alt = card.getAttribute("alt").toLowerCase();
            if (alt.includes(searchTerm)) {
              card.parentElement.style.display = "flex";
            } else {
              card.parentElement.style.display = "none";
            }
          });
        }
      </script>
      <input type="checkbox" id="burger-toggle" />
      <label for="burger-toggle" class="burger-icon">
        <i class="fas fa-bars"></i>
      </label>
      <div class="burger-menu">
        <ul class="burger-menu-list">
          <li>
            <a href="/">
              <i class="fas fa-house"></i>
              <span>Home</span>
            </a>
          </li>
          <li>
            <a href="/rules/">
              <i class="fas fa-clipboard-check"></i>
              <span>Rules</span>
            </a>
          </li>
          <li>
            <a href="/cards/">
              <i class="fas fa-sheet-plastic"></i>
              <span>Cards</span>
            </a>
          </li>
        </ul>
      </div>
      <script defer>
        const burgerToggle = document.getElementById("burger-toggle");
        const burgerMenu = document.querySelector(".burger-menu");
        burgerToggle.addEventListener("change", () => {
          if (burgerToggle.checked) {
            burgerMenu.style.transform = "scaleY(1)";
          } else {
            burgerMenu.style.transform = "scaleY(0)";
          }
        });
      </script>
    </header>
    <div class="big-title">
      <h1>Characters</h1>
      <div class="tags-container"></div>
    </div>
    <main class="cards-container" id="cards-container">
      <!-- <div>
        <img
          class="card-img"
          src="../../assets/images/cards/HarryPotter.png"
          alt=""
        />
        <h4>Harry Potter</h4>
      </div> -->
      <script>
        const createCards = async () => {
          try {
            const response = await fetch("./data.json");
            const data = await response.json();
            const tagList = data.tags;
            const container = document.querySelector(".cards-container");

            function formatCheckboxTitle(string) {
              return " " + string.charAt(0).toUpperCase() + string.slice(1);
            }

            tagList.forEach((element) => {
              const tagsContainer = document.querySelector(".tags-container");
              const tag = document.createElement("label");
              tag.classList.add("tag");
              const checkbox = document.createElement("input");
              checkbox.type = "checkbox";
              checkbox.value = element;
              checkbox.addEventListener("change", () => {
                const cards = document.querySelectorAll(".card-img");
                const checkedTags = Array.from(
                  document.querySelectorAll(".tag input:checked")
                ).map((checkbox) => checkbox.value);
                cards.forEach((card) => {
                  if (
                    checkedTags.length === 0 ||
                    checkedTags.some((tag) => card.classList.contains(tag))
                  ) {
                    card.parentElement.style.display = "flex";
                  } else {
                    card.parentElement.style.display = "none";
                  }
                });
              });
              tag.appendChild(checkbox);
              tag.appendChild(
                document.createTextNode(formatCheckboxTitle(element))
              );
              tagsContainer.appendChild(tag);
            });

            const imageResponse = await fetch("https://hp-api.lyenx.com/cards");
            const imageData = await imageResponse.json();
            imageData.forEach((element) => {
              container.appendChild(document.createElement("div"));
              const div = container.lastChild;
              div.id = element.id;
              div.classList.add("card");
              div.addEventListener("click", () => {
                window.location.href = `?id=${div.id}`;
              });
              let img = document.createElement("img");
              img.classList.add("card-img");
              img.src = `https://hp-api.lyenx.com/images/${element.image}`;
              img.alt = element.name;
              element.tags
                .split(",")
                .forEach((tag) => (tag ? img.classList.add(tag) : null));
              div.appendChild(img);
              let title = document.createElement("h4");
              title.innerText = element.name;
              div.appendChild(title);
              // console.log(i);
            });
            showOnlyOneCard();
          } catch (error) {
            console.error("Erreur lors du traitement des images :", error);
          }
        };

        createCards();

        function showOnlyOneCard() {
          const urlParams = new URLSearchParams(window.location.search);
          const id = urlParams.get("id");

          if (id) {
            console.log("id");
            const cards = document.querySelectorAll(".card");
            console.log(cards);
            cards.forEach((card) => {
              if (card.id !== id) {
                console.log("a" + card.id);
                card.classList.add("card-hidden");
              }
            });
            document
              .getElementById("cards-container")
              .classList.add("cards-container-onlyone");
          }
        }
      </script>
    </main>
    <footer>
      <div class="socials">
        <a href="#"><i class="fab fa-youtube"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
      </div>
      <div class="legal">
        <a href="#">Terms of Use</a>
        <p>&middot;</p>
        <a href="#">Privacy Policy</a>
      </div>
      <div class="copyright">
        <p>&copy; Eric Hubert, <span id="copy-date"></span></p>
      </div>
      <script async type="module">
        document.getElementById("copy-date").innerText =
          new Date().getFullYear();
      </script>
    </footer>
  </body>
</html>
